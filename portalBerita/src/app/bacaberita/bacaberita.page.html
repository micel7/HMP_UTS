<ion-header>
  <ion-toolbar>
    <ion-title>{{ selectedBerita?.judul }}</ion-title>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="selectedBerita">
  <ion-img [src]="selectedBerita.foto"></ion-img>
  <div class="favorite-icon" (click)="onToggleFavorite(selectedBerita, $event)">
    <ion-icon name="heart" color="danger" *ngIf="selectedBerita.isFavorite"></ion-icon>
    <ion-icon name="heart-outline" color="medium" *ngIf="!selectedBerita.isFavorite"></ion-icon>
  </div>
  
  <div class="ion-padding">
    <h1>{{ selectedBerita.judul }}</h1>
    <p style="font-size:22px">{{ selectedBerita.konten }}</p>
    <!-- Menampilkan gambar halaman (array) -->
    <div *ngIf="selectedBerita.gambarHalaman && selectedBerita.gambarHalaman.length > 0" class="image-gallery">
      <ion-grid>
        <ion-row>
          <ion-col size="6" *ngFor="let gambar of selectedBerita.gambarHalaman">
            <ion-img [src]="gambar" class="gallery-image"></ion-img>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </div>
  
  <ion-list>
    <ion-list-header>
      <h3>Beri Rating Anda</h3>
    </ion-list-header>

    <ion-item *ngIf="ratingSubmitted" lines="none">
      <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
      <ion-label>
        <h2>Terima kasih!</h2> 
        <p>Anda sudah memberikan rating {{userRating}} untuk berita ini.</p>
      </ion-label>
    </ion-item>
    
    <div *ngIf="!ratingSubmitted" class="ion-padding">
      <div class="rating-stars">
        <ion-icon (click)="rate(1)" [name]="userRating >= 1 ? 'star' : 'star-outline'" [color]="userRating >= 1 ? 'warning' : 'medium'"></ion-icon>
        <ion-icon (click)="rate(2)" [name]="userRating >= 2 ? 'star' : 'star-outline'" [color]="userRating >= 2 ? 'warning' : 'medium'"></ion-icon>
        <ion-icon (click)="rate(3)" [name]="userRating >= 3 ? 'star' : 'star-outline'" [color]="userRating >= 3 ? 'warning' : 'medium'"></ion-icon>
        <ion-icon (click)="rate(4)" [name]="userRating >= 4 ? 'star' : 'star-outline'" [color]="userRating >= 4 ? 'warning' : 'medium'"></ion-icon>
        <ion-icon (click)="rate(5)" [name]="userRating >= 5 ? 'star' : 'star-outline'" [color]="userRating >= 5 ? 'warning' : 'medium'"></ion-icon>
      </div>

      <ion-button expand="block" (click)="submitRating()" [disabled]="userRating === 0" class="ion-margin-top">
        Kirim Rating
      </ion-button>
    </div>
  </ion-list>

  <ion-list>
    <ion-list-header>
      <h3>Komentar ({{ selectedBerita.komentar?.length }})</h3>
    </ion-list-header>
  
    <ion-item>
      <ion-textarea
        [(ngModel)]="newCommentText"
        placeholder="Tulis komentar Anda di sini..."
        autoGrow="true"
      ></ion-textarea>
    </ion-item>
    <ion-button 
      expand="block" 
      class="ion-margin"
      (click)="submitComment()"
      [disabled]="newCommentText.trim() === ''">
      Kirim Komentar
    </ion-button>
  
    </ion-list>

    <!-- Buat reply comment -->
    <div *ngFor="let komen of selectedBerita.komentar" class="comment-thread">
      <ion-item>
        <ion-label class="ion-text-wrap">
        <h2>{{komen.username}}</h2>
        <p>{{komen.isi}}</p>
        <div class="comment-footer">
          <p class="comment-date"> {{ komen.tanggal | date:'short' }}</p>
          <ion-button name="btnReplyComment" fill="clear" size="small" (click)="toggleReplyForm(komen.id)">Balas</ion-button>
        </div>
      </ion-label>
      </ion-item>

    <div *ngIf="replyingToCommentId === komen.id" class="reply-form">
      <ion-item>
        <ion-textarea [(ngModel)]="replyText" placeholder="Tulis balasan..." autoGrow="true"></ion-textarea>
      </ion-item>
      <div class="reply-buttons">
        <ion-button size="small" (click)="submitReply(komen.id)">Kirim</ion-button>
        <ion-button fill="clear" size="small" (click)="toggleReplyForm(komen.id)">Batal</ion-button>
      </div>
    </div>

    <div *ngIf="komen.replies && komen.replies.length > 0" class="replies-container"> 
      <!-- Loop ini buat menampilkan setiap balasan -->
      <ion-item *ngFor="let reply of komen.replies">

          <ion-label class="ion-text-wrap">
            <h2>{{ reply.username }}</h2>
            <p>{{ reply.isi }}</p>
            <div class="comment-footer">
              <p class="comment-date">{{ reply.tanggal | date:'short' }}</p>
              <ion-button fill="clear" size="small" (click)="toggleReplyForm(komen.id)">Balas</ion-button>
            </div>
          </ion-label>

      </ion-item>

    </div>
  </div>
    

  </ion-content>